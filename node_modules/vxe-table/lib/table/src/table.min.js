"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=require("../../v-x-e-table"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20;function renderFixed(e,t,i){var l=t.tableData,o=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.height,c=t.containerHeight,u=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,g=t.showFooter,v=t.tableHeight,p=t.scrollYWidth,m=t.scrollXHeight,x=t.scrollRightToLeft,b=t.scrollLeftToRight,w=t.columnStore,C=t.footerData,S="auto"===a?c:_xeUtils.default.toNumber(a),T="right"===i,_=w["".concat(i,"List")],E={height:"".concat((0<S?S-h-d:v)+h+d-m*(g?2:1),"px"),width:"".concat(_.reduce(function(e,t){return e+t.renderWidth},T?p:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(i,"-wrapper"),{"scrolling--middle":T?x:b}],style:E,ref:"fixedTable"},[f?e("vxe-table-header",{props:{fixedType:i,tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:u,fixedColumn:_,isGroup:s},ref:"".concat(i,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:i,tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,fixedColumn:_,size:u,isGroup:s},ref:"".concat(i,"Body")}),g?e("vxe-table-footer",{style:{top:"".concat(S?S-d:v,"px")},props:{fixedType:i,footerData:C,tableColumn:o,visibleColumn:n,size:u,fixedColumn:_},ref:"".concat(i,"Footer")}):null])}var _default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:Boolean,highlightHoverRow:Boolean,highlightCurrentColumn:Boolean,highlightHoverColumn:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],spanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,rowKey:[String,Number],autoResize:Boolean,radioConfig:Object,selectConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object},provide:function(){return{$table:this}},data:function(){return{id:_xeUtils.default.uniqueId(),headerProps:{children:"children"},collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],containerHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollYWidth:0,scrollXHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,isAllSelected:!1,isIndeterminate:!1,selection:[],selectRow:null,selectColumn:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],hoverRow:null,isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _conf.default._tip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuConfig.header&&this.ctxMenuConfig.header.options?this.ctxMenuConfig.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuConfig.body&&this.ctxMenuConfig.body.options?this.ctxMenuConfig.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuConfig:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t}},watch:{data:function(e){this.isUpdateData||this.loadData(e,!0).then(this.handleDefault),this.isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=_tools.UtilTools.getColumnList(e);this.tableFullColumn=t,this.cacheColumnMap()},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this.isLoading||(this.isLoading=!0)}},created:function(){var t=this,e=this.scrollYStore,i=this.optimizeOpts,l=this.radioConfig,o=void 0===l?{}:l,n=this.selectConfig,r=void 0===n?{}:n,s=this.treeConfig,a=this.editConfig,c=this.loading,u=this.showAllOverflow,h=this.showHeaderAllOverflow,d=i.scrollY;c&&(this.isLoading=!0),d&&Object.assign(e,{startIndex:0,visibleIndex:0,renderSize:d.rSize,offsetSize:d.oSize}),_xeUtils.default.isBoolean(u)&&console.warn("[vxe-table] The property show-all-overflow is deprecated, please use show-overflow"),_xeUtils.default.isBoolean(h)&&console.warn("[vxe-table] The property show-header-all-overflow is deprecated, please use show-header-overflow"),o.labelProp&&console.warn("[vxe-table] The property labelProp is deprecated, please use labelField"),r.checkProp&&console.warn("[vxe-table] The property checkProp is deprecated, please use checkField"),r.labelProp&&console.warn("[vxe-table] The property labelProp is deprecated, please use labelField"),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.fullDataIndexMap=new Map,this.fullDataRowIdMap=new Map,this.fullColumnIndexMap=new Map,this.loadData(this.data,!0).then(function(){var e=_tools.UtilTools.getRowKey(t);if(r&&r.reserve&&!e)throw new Error("[vxe-table] Checkbox status reserve must have a unique primary key.");if(s&&!e)throw new Error("[vxe-table] Tree table must have a unique primary key.");if(a&&!e)throw new Error("[vxe-table] Editable must have a unique primary key.");t.tableFullColumn=_tools.UtilTools.getColumnList(t.collectColumn),t.customs&&t.mergeCustomColumn(t.customs),t.refreshColumn(),t.handleDefault()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent)},mounted:function(){this.autoResize&&_tools.ResizeEvent.on(this,this.$el.parentNode,this.recalculate),document.body.appendChild(this.$refs.tableWrapper)},activated:function(){var e=this.$refs,t=this.lastScrollTop,i=this.lastScrollLeft,l=e.tableBody.$el;l&&(t&&(l.scrollTop=t),i&&(l.scrollLeft=i))},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.$el.parentNode),this.afterFullData.length=0,this.fullDataIndexMap.clear(),this.fullColumnIndexMap.clear(),this.closeFilter(),this.closeMenu()},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize")},render:function(e){var t=this._e,i=this.id,l=this.tableData,o=this.tableColumn,n=this.visibleColumn,r=this.collectColumn,s=this.isGroup,a=this.hasFilter,c=this.isResizable,u=this.isCtxMenu,h=this.loading,d=this.isLoading,f=this.showHeader,g=this.border,v=this.stripe,p=this.highlightHoverRow,m=this.highlightHoverColumn,x=this.vSize,b=this.editConfig,w=this.validConfig,C=void 0===w?{}:w,S=this.editRules,T=this.showFooter,_=this.footerMethod,E=this.overflowX,y=this.overflowY,D=this.scrollXHeight,k=this.optimizeOpts,I=this.columnStore,U=this.filterStore,M=this.ctxMenuStore,R=this.tooltipStore,$=this.tooltipConfig,F=this.validStore,O=this.footerData,L=this.hasTip,z=I.leftList,A=I.rightList;return e("div",{class:["vxe-table",x?"size--".concat(x):"",{"vxe-editable":b,"show--head":f,"show--foot":T,"scroll--y":y,"scroll--x":E,"fixed--left":z.length,"fixed--right":A.length,"t--animat":k.animat,"t--stripe":v,"t--border":g,"row--highlight":p,"column--highlight":m}]},[e("div",{class:["vxe-table-hidden-column"],ref:"hideColumn"},this.$slots.default),f?e("vxe-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:x,isGroup:s}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:x,isGroup:s}}),T?e("vxe-table-footer",{props:{footerData:O,footerMethod:_,tableColumn:o,visibleColumn:n,size:x},ref:"tableFooter"}):t(),z&&z.length&&E?renderFixed(e,this,"left"):t(),A&&A.length&&E?renderFixed(e,this,"right"):t(),c?e("div",{class:["vxe-table--resizable-bar"],style:E?{"padding-bottom":"".concat(D,"px")}:null,ref:"resizeBar"}):t(),d?e("vxe-table-loading",{props:{visible:h}}):t(),e("div",{class:["vxe-table".concat(i,"-wrapper")],ref:"tableWrapper"},[a?e("vxe-table-filter",{props:{optimizeOpts:k,filterStore:U},ref:"filterWrapper"}):t(),u?e("vxe-table-context-menu",{props:{ctxMenuStore:M},ref:"ctxWrapper"}):t(),L?e("vxe-tooltip",{props:Object.assign({},R,$),ref:"tooltip"}):t(),L&&S&&"none"!==C.message?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===C.message||1===l.length?Object.assign({},F,$):null,ref:"validTip"}):t()])])},methods:{clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.tableFullData=this.data||[],this.tableData=this.getTableData(!0).tableData,this.$nextTick()},clearAll:function(){return this.clearScroll(),this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.$nextTick()},loadData:function(e,t){var i=this.height,l=this.maxHeight,o=this.editStore,n=this.optimizeOpts,r=this.recalculate,s=n.scrollY,a=e||[],c=s&&s.gt&&s.gt<a.length;if(o.insertList=[],o.removeList=[],this.tableSourceData=_xeUtils.default.clone(a,!0),this.tableFullData=a,(this.scrollYLoad=c)&&!i&&!l)throw new Error("[vxe-table] The height/max-height must be set for the scroll load.");this.tableData=this.getTableData(!0).tableData,this.cacheDataMap(),this.reserveCheckSelection(),this.checkSelectionStatus();var u=this.$nextTick();return t||(u=u.then(r)),u},reloadData:function(e){return this.clearAll(),this.loadData(e).then(this.handleDefault)},loadColumn:function(e){var t=this,i=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},this.headerProps);return this.collectColumn=i,this.tableFullColumn=_tools.UtilTools.getColumnList(i),this.customs&&this.mergeCustomColumn(this.customs),this.cacheColumnMap(),this.refreshColumn(),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},cacheDataMap:function(){var i=this,e=this.treeConfig,t=this.tableFullData,l=this.fullDataIndexMap,o=this.fullDataRowIdMap;if(l.clear(),o.clear(),e){var n=_tools.UtilTools.getRowKey(this);_xeUtils.default.eachTree(t,function(e,t){o.set(""+_xeUtils.default.get(e,n),{rowKey:n,row:e,index:t})},e)}else t.forEach(function(e,t){o.set(_tools.UtilTools.getRowId(i,e,t),{row:e,index:t}),l.set(e,{row:e,index:t})})},cacheColumnMap:function(){var e=this.tableFullColumn,i=this.fullColumnIndexMap;i.clear(),e.forEach(function(e,t){i.set(e,{row:e,index:t})})},getRowMapIndex:function(e){return this.fullDataIndexMap.has(e)?this.fullDataIndexMap.get(e).index:-1},getRowIndex:function(t){var e=this.tableFullData,i=this.treeConfig;return i?_xeUtils.default.findTree(e,function(e){return e===t},i):this.getRowMapIndex(t)},getColumnMapIndex:function(e){return this.fullColumnIndexMap.has(e)?this.fullColumnIndexMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},insert:function(e){return this.insertAt(e)},insertAt:function(e,i){var l=this,o=arguments,n=this.tableData,r=this.editStore,t=this.defineProperty,s=this.scrollYLoad,a=this.tableFullData;_xeUtils.default.isArray(e)||(e=[e]);var c=e.map(function(e){return t(e)});return new Promise(function(e){if(1===o.length)n.unshift.apply(n,c),s&&(a.unshift.apply(a,c),l.updateAfterFullData());else{if(s)throw new Error("[vxe-table] Virtual scroller does not support this operation.");if(-1===i)n.push.apply(n,c);else{var t=n.indexOf(i);n.splice.apply(n,[t,0].concat(c))}}[].unshift.apply(r.insertList,c),l.checkSelectionStatus(),l.$nextTick(function(){l.recalculate(),e({row:c.length?c[c.length-1]:null,rows:c})})})},defineProperty:function(e){var t=Object.assign({},e),i=_tools.UtilTools.getRowKey(this);return this.visibleColumn.forEach(function(e){e.property&&!_xeUtils.default.has(t,e.property)&&_xeUtils.default.set(t,e.property,null)}),i&&!_xeUtils.default.get(t,i)&&_xeUtils.default.set(t,i,++rowUniqueId+Date.now()),t},remove:function(r){var e=this,t=this.tableData,s=this.tableFullData,i=this.editStore,a=this.treeConfig,l=this.selectConfig,o=void 0===l?{}:l,c=this.selection,u=this.hasRowInsert,h=i.removeList,n=i.insertList,d=o.checkField||o.checkProp,f=[];return this.isUpdateData=!0,r&&(_xeUtils.default.isArray(r)||(r=[r]),a?r.forEach(function(t){var e=_xeUtils.default.findTree(s,function(e){return e===t},a);if(e){var i=e.item,l=e.items,o=e.index;u(i)||h.push(i);var n=l.splice(o,1)[0];d||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),f.push(n)}}):(r.forEach(function(e){u(e)||h.push(e)}),f=_xeUtils.default.remove(s,function(e){return-1<r.indexOf(e)}),d||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),_xeUtils.default.remove(t,function(e){return-1<r.indexOf(e)})),_xeUtils.default.remove(n,function(e){return-1<r.indexOf(e)})),this.checkSelectionStatus(),this.$nextTick().then(function(){return e.recalculate(),{row:r&&r.length?r[r.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(e,l){var o=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),i=o[t];i&&e&&(l?_xeUtils.default.set(e,l,_xeUtils.default.get(i,l)):_xeUtils.default.destructuring(e,i))}),this.$nextTick()):this.reloadData(o)},clearData:function(e,t){var i=this.tableSourceData,l=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){l.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasRowInsert:function(t){var e=this.treeConfig,i=this.tableSourceData;return e?_xeUtils.default.findTree(i,function(e){return e===t},e):-1===this.getRowMapIndex(t)},hasRowChange:function(e,t){var i,l=this.tableSourceData,o=this.treeConfig,n=_tools.UtilTools.getRowKey(this);if(n||o){var r=_xeUtils.default.get(e,n);if(o){var s=o.children,a=_xeUtils.default.findTree(l,function(e){return r===_xeUtils.default.get(e,n)},o);e=Object.assign({},e,_defineProperty({},s,null)),a&&(i=Object.assign({},a.item,_defineProperty({},s,null)))}else i=l.find(function(e){return r===_xeUtils.default.get(e,n)})}else{i=l[this.getRowMapIndex(e)]}return 1<arguments.length?i&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t)):i&&!_xeUtils.default.isEqual(i,e)},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t},getRecords:function(e){var t=this.tableFullData;return arguments.length?t[e]:t},getAllRecords:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.editStore,i=this.treeConfig,l=this.selectConfig,o=void 0===l?{}:l,n=this.selection,r=o.checkField||o.checkProp,s=[],a=[];return a=r?(s=i?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,r)},i):e.filter(function(e){return _xeUtils.default.get(e,r)}),t.insertList.filter(function(e){return _xeUtils.default.get(e,r)})):(s=i?_xeUtils.default.filterTree(e,function(e){return-1<n.indexOf(e)},i):e.filter(function(e){return-1<n.indexOf(e)}),t.insertList.filter(function(e){return-1<n.indexOf(e)})),s.concat(a)},getUpdateRecords:function(){var e=this.tableFullData,t=this.hasRowChange;return this.treeConfig?_xeUtils.default.filterTree(e,function(e){return t(e)}):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,c=this.remoteFilter,i=this.visibleColumn.find(function(e){return e.order}),l=t,o=e.filter(function(e){var t=e.filters;return t&&t.length});if(l=l.filter(function(a){return o.every(function(t){var e=t.property,i=t.filters,l=t.filterMethod,o=t.filterRender,n=o?_vXETable.Renderer.get(o.name):null,r=[],s=[];return!(i&&i.length&&(i.forEach(function(e){e.checked&&(s.push(e),r.push(e.value))}),r.length&&!c))||(!l&&n&&n.renderFilter&&(l=n.filterMethod),l?s.some(function(e){return l({value:e.value,option:e,row:a,column:t})}):-1<r.indexOf(_xeUtils.default.get(a,e)))})}),i&&i.order){var n=_xeUtils.default.sortBy(l,i.property);l="desc"===i.order?n.reverse():n}return this.afterFullData=l},getTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,l=e?this.updateAfterFullData():this.afterFullData;return{fullData:l,tableData:t?l.slice(i.startIndex,i.startIndex+i.renderSize):l.slice(0)}},handleDefault:function(){this.selectConfig&&this.handleDefaultRowChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(i){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=i.find(function(e){return t.property&&(e.field||e.prop)===t.property});t.visible=!e||!!e.visible}),this.$emit("update:customs",this.tableFullColumn)},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,l=0,o=[],n=0,r=[],s=[],t=this.headerProps,e=this.collectColumn,a=this.tableFullColumn,c=this.isGroup,u=this.columnStore,h=this.scrollXStore,d=this.optimizeOpts.scrollX;c&&_xeUtils.default.eachTree(e,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},t))},t),a.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(i||(t-l!=0?i=!0:l++),o.push(e)):"right"===e.fixed?(i||(n||(n=t),t-n!=0?i=!0:n++),s.push(e)):r.push(e)});var f=o.concat(r).concat(s),g=d&&d.gt&&d.gt<a.length;if(Object.assign(u,{leftList:o,centerList:r,rightList:s}),i&&c||n&&n!==f.length)throw new Error("[vxe-table] Fixed column must to the left and right sides.");return g&&(Object.assign(h,{startIndex:0,visibleIndex:0,renderSize:d.rSize,offsetSize:d.oSize}),f=f.slice(h.startIndex,h.startIndex+h.renderSize)),this.scrollXLoad=g,this.tableColumn=f,this.$nextTick().then(this.recalculate).then(this.recalculate)},analyColumnWidth:function(){var t=[],i=[],l=[],o=[],n=[],r=[];this.tableFullColumn.forEach(function(e){e.visible&&(e.resizeWidth?t.push(e):_tools.DomTools.isPx(e.width)?i.push(e):_tools.DomTools.isScale(e.width)?o.push(e):_tools.DomTools.isPx(e.minWidth)?l.push(e):_tools.DomTools.isScale(e.minWidth)?n.push(e):r.push(e))}),Object.assign(this.columnStore,{resizeList:t,pxList:i,pxMinList:l,scaleList:o,scaleMinList:n,autoList:r})},recalculate:function(e){var t=this,i=this.$refs,l=i.tableBody,o=i.tableHeader,n=i.tableFooter,r=l?l.$el:null,s=o?o.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth,u=this.autoCellWidth(s,r,a,c);if(!0===e)return this.$nextTick().then(function(){(c=r.clientWidth)!==u&&t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.$nextTick().then(this.computeScrollLoad)},autoCellWidth:function(e,t,i,l){var o,n=0,r=l,s=this.$el,a=this.fit,c=this.columnStore,u=c.resizeList,h=c.pxMinList,d=c.pxList,f=c.scaleList,g=c.scaleMinList,v=c.autoList;h.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),o=r/100,g.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*o);n+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.width)*o);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),o=0<(r-=n)?Math.max(Math.floor(r/(g.length+h.length+v.length)),40):40,a?0<r&&g.concat(h).forEach(function(e){n+=o,e.renderWidth+=o}):o=40,v.forEach(function(e,t){if(e.renderWidth=o,n+=o,a&&t===v.length-1){var i=l-n;0<i&&(e.renderWidth+=i,n=l)}});var p=t.offsetHeight,m=t.offsetWidth-l;if(this.scrollYWidth=m,this.overflowY=0<m,this.tableWidth=n,this.tableHeight=p,this.containerHeight=s.parentNode.clientHeight,e&&(this.headerHeight=e.offsetHeight),i){var x=i.offsetHeight;this.scrollXHeight=Math.max(x-i.clientHeight,0),this.overflowX=n>i.clientWidth,this.footerHeight=x}else this.scrollXHeight=Math.max(p-t.clientHeight,0),this.overflowX=l<n;return this.overflowX&&this.checkScrolling(),n},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftBody,l=e.rightBody,o=t?t.$el:null;o&&(i&&(this.scrollLeftToRight=0<o.scrollLeft),l&&(this.scrollRightToLeft=o.clientWidth<o.scrollWidth-o.scrollLeft))},preventEvent:function(t,e,i,l){var o=this;_vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,o)})||l()},handleGlobalMousedownEvent:function(o){var n=this,e=this.$refs,t=this.editStore,i=this.ctxMenuStore,l=this.editConfig,r=void 0===l?{}:l,s=this.filterStore,a=t.actived,c=e.filterWrapper,u=e.validTip;c&&(this.getEventTargetNode(o,this.$el,"vxe-filter-wrapper").flag||this.getEventTargetNode(o,c.$el).flag||this.preventEvent(o,"event.clear_filter",s.args,this.closeFilter)),a.row&&!1!==r.autoClear&&(u&&this.getEventTargetNode(o,u.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(o,"event.clear_actived",a.args,function(){var e,t=!n.getEventTargetNode(o,n.$el,"col--edit").flag;if("row"===r.mode){var i=n.getEventTargetNode(o,n.$el,"vxe-body--row"),l=i.flag?i.targetElem!==a.args.cell.parentNode:0;e="manual"===r.trigger?l:l&&t}else e=t;!e&&n.getEventTargetNode(o,n.$el).flag||setTimeout(n.clearActived)})),i.visible&&this.$refs.ctxWrapper&&!this.getEventTargetNode(o,this.$refs.ctxWrapper.$el).flag&&this.closeMenu()},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(e){var t,i=this.isCtxMenu,l=this.ctxMenuStore,o=this.editStore,n=this.mouseConfig,r=void 0===n?{}:n,s=this.keyboardConfig,a=void 0===s?{}:s,c=o.selected,u=o.actived,h=e.keyCode,d=8===h,f=9===h,g=13===h,v=27===h,p=32===h,m=37===h,x=38===h,b=39===h,w=40===h,C=46===h,S=67===h,T=86===h,_=88===h,E=113===h,y=e.ctrlKey,D=m||x||b||w,k=i&&l.visible&&(g||p||D);v?(this.closeMenu(),this.closeFilter(),u.row&&(t=u.args,this.clearActived(e),r.selected&&this.handleSelected(t,e))):g&&(a.isArrow||a.isTab)&&(c.row||u.row)?this.moveSelected(c.row?c.args:u.args,m,x,b,!0,e):k?(e.preventDefault(),l.showChild&&_tools.UtilTools.hasChildrenList(l.selected)?this.moveCtxMenu(e,h,l,"selectChild",37,!1,l.selected.children):this.moveCtxMenu(e,h,l,"selected",39,!0,this.ctxMenuList)):E?c.row&&c.column&&this.handleActived(c.args,e):D&&a.isArrow?c.row&&c.column&&(e.preventDefault(),this.moveSelected(c.args,m,x,b,w,e)):f&&a.isTab?c.row||c.column?(e.preventDefault(),this.moveTabSelected(c.args,e)):(u.row||u.column)&&(e.preventDefault(),this.moveTabSelected(u.args,e)):C||d?a.isDel&&(c.row||c.column)&&(_tools.UtilTools.setCellValue(c.row,c.column,null),d&&this.handleActived(c.args,e)):a.isCut&&y&&(_||S||T)?_||S?this.handleCopyed(_,e):this.handlePaste(e):a.isEdit&&!y&&(48<=h&&h<=57||65<=h&&h<=90||96<=h&&h<=111||186<=h&&h<=192||219<=h&&h<=222||32===h)&&(c.row||c.column)&&(a.editMethod&&!1===a.editMethod(c.args,e)||(_tools.UtilTools.setCellValue(c.row,c.column,null),this.handleActived(c.args,e)))},moveTabSelected:function(e,t){for(var i,l,o,n,r=this.tableData,s=this.visibleColumn,a=this.editConfig,c=Object.assign({},e),u=r.indexOf(c.row),h=s.indexOf(c.column)+1;h<s.length;h++)if(s[h].editRender){o=s[n=h];break}if(!o&&u<r.length-1){i=r[l=u+1];for(var d=0;d<s.length;d++)if(s[d].editRender){o=s[n=d];break}}o&&(i?(c.rowIndex=l,c.row=i):c.rowIndex=u,c.columnIndex=n,c.column=o,c.cell=_tools.DomTools.getCell(this,c),a&&("click"===a.trigger?this.handleActived(c,t):"dblclick"===a.trigger&&this.handleSelected(c,t)))},moveSelected:function(e,t,i,l,o,n){var r=this.tableData,s=this.visibleColumn,a=this.handleSelected,c=Object.assign({},e);if(i&&c.rowIndex)c.rowIndex-=1,c.row=r[c.rowIndex];else if(o&&c.rowIndex<r.length-1)c.rowIndex+=1,c.row=r[c.rowIndex];else if(t&&c.columnIndex){for(var u=c.columnIndex-1;0<=u;u--)if(s[u].editRender){c.columnIndex=u,c.column=s[u];break}}else if(l&&c.columnIndex)for(var h=c.columnIndex+1;h<s.length;h++)if(s[h].editRender){c.columnIndex=h,c.column=s[h];break}c.cell=_tools.DomTools.getCell(this,c),a(c,n)},moveCtxMenu:function(e,t,i,l,o,n,r){var s=_xeUtils.default.findIndexOf(r,function(e){return i[l]===e});t===o?n&&_tools.UtilTools.hasChildrenList(i.selected)?i.showChild=!0:(i.showChild=!1,i.selectChild=null):38===t?i[l]=r[s-1]||r[r.length-1]:40===t?i[l]=r[s+1]||r[0]:!i[l]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,i[l])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,i=this.ctxMenuStore;if(t){if(i.visible&&i.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();if(this.getEventTargetNode(e,this.$el,"vxe-table--header-wrapper").flag)return void this.openContextMenu(e,"header",{});if(this.getEventTargetNode(e,this.$el,"vxe-table--body-wrapper").flag)return void this.openContextMenu(e,"body",{});if(this.getEventTargetNode(e,this.$el,"vxe-table--footer-wrapper").flag)return void this.openContextMenu(e,"footer",{})}this.closeMenu(),this.closeFilter()},openContextMenu:function(n,e,t){var r=this,i=this.tableData,l=this.visibleColumn,s=this.ctxMenuStore,o=this.ctxMenuConfig,a=this.fullDataRowIdMap,c=this.tableFullColumn,u=o[e];if(u){var h=u.options,d=u.visibleMethod;if(u.disabled)n.preventDefault();else if(h&&h.length)if(!d||d(t,n)){n.preventDefault();var f=_tools.DomTools.getDomNode(),g=f.scrollTop,v=f.scrollLeft,p=f.visibleHeight,m=f.visibleWidth,x=this.getEventTargetNode(n,this.$el,"vxe-".concat(e,"--column")),b=x.targetElem,w={type:e,$table:this};if(x.flag){var C=_tools.DomTools.getCellIndexs(b),S=C.rowId,T=C.rowIndex,_=C.colIndex,E=C.columnIndex,y=_?c[_]:l[E];if("body"===e){var D=(S?a.get(S):i[T]).row;w.row=D,w.rowIndex=T}Object.assign(w,{column:y,columnIndex:E,cell:b})}var k=n.clientY+g,I=n.clientX+v;Object.assign(s,{args:w,visible:!0,list:h,selected:null,selectChild:null,showChild:!1,style:{top:"".concat(k,"px"),left:"".concat(I,"px")}}),this.$nextTick(function(){var e=r.$refs.ctxWrapper.$el,t=e.clientHeight,i=e.clientWidth,l=n.clientY+t-p,o=n.clientX+i-m;-10<l&&(s.style.top="".concat(k-t,"px")),-10<o&&(s.style.left="".concat(I-i,"px"))})}else this.closeMenu()}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,i){var l=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),l.selected=t,(l.selectChild=i)||(l.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,i){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){t.disabled||t.children&&t.children.length||(_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t},this.ctxMenuStore.args),e]),this.closeMenu())},triggerHeaderTooltipEvent:function(e,t){var i=t.column,l=this.tooltipStore,o=i.own;l.column===i&&l.visible||this.showTooltip(e,o.title||o.label,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,l=this.editStore,o=this.tooltipStore,n=l.actived,r=t.row,s=t.column;i&&("row"===i.mode&&n.row===r||n.row===r&&n.column===s)||o.column===s&&o.row===r&&o.visible||this.showTooltip(e,_tools.UtilTools.getCellLabel(r,s,t),s,r)},showTooltip:function(e,t,i,l){var o=e.currentTarget,n=this.$refs.tooltip,r=o.children[0];return t&&r.scrollWidth>r.clientWidth&&(Object.assign(this.tooltipStore,{row:l,column:i,content:_tools.UtilTools.formatText(t),visible:!0}),n&&n.toVisible(o)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleDefaultRowChecked:function(){var e=this.selectConfig,t=void 0===e?{}:e,i=this.tableFullData,l=t.checkAll,o=t.checkRowKeys,n=_tools.UtilTools.getRowKey(this);if(l)this.setAllSelection(!0);else if(o){var r=n;if(!r)throw new Error("[vxe-table] Checked rows must have a unique primary key.");this.setSelection(o.map(function(t){return i.find(function(e){return t===e[r]})}),!0)}},setSelection:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.triggerCheckRowEvent(null,{row:e},!!t)}),this.$nextTick()},triggerCheckRowEvent:function(e,t,i){var l=t.row,o=this.selection,n=this.tableFullData,r=this.selectConfig,s=void 0===r?{}:r,a=this.treeConfig,c=this.treeIndeterminates,u=s.checkMethod,h=s.checkField||s.checkProp;if(!u||u({row:l,rowIndex:n.indexOf(l)})){if(h)if(a){-1===i?(c.push(l),_xeUtils.default.set(l,h,!1)):(_xeUtils.default.eachTree([l],function(e){return _xeUtils.default.set(e,h,i)},a),_xeUtils.default.remove(c,function(e){return e===l}));var d=_xeUtils.default.findTree(n,function(e){return e===l},a);if(d&&d.parent){var f=d.items.filter(function(e){return _xeUtils.default.get(e,h)});return this.triggerCheckRowEvent(e,{row:d.parent},f.length===d.items.length||!(!f.length&&-1!==i)&&-1)}}else _xeUtils.default.set(l,h,i);else if(a){-1===i?(c.push(l),_xeUtils.default.remove(o,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t){i?-1===o.indexOf(t)&&o.push(t):_xeUtils.default.remove(o,function(e){return e===t})},a),_xeUtils.default.remove(c,function(e){return e===l}));var g=_xeUtils.default.findTree(n,function(e){return e===l},a);if(g&&g.parent){var v=g.items.filter(function(e){return-1<o.indexOf(e)});return this.triggerCheckRowEvent(e,{row:g.parent},v.length===g.items.length||!(!v.length&&-1!==i)&&-1)}}else i?-1===o.indexOf(l)&&o.push(l):_xeUtils.default.remove(o,function(e){return e===l});this.checkSelectionStatus(),_tools.UtilTools.emitEvent(this,"select-change",[{row:l,selection:this.getSelectRecords(),checked:i},e])}},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,i=this.selectConfig,l=void 0===i?{}:i,o=this.selection,n=this.treeIndeterminates,r=l.checkMethod,s=l.checkField||l.checkProp,a=t.insertList;a.length&&(e=e.concat(a)),s?(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t})||_xeUtils.default.get(e,s)}:function(e){return _xeUtils.default.get(e,s)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,s)||-1<n.indexOf(e)})):(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t})||-1<o.indexOf(e)}:function(e){return-1<o.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<n.indexOf(e)||-1<o.indexOf(e)}))},reserveCheckSelection:function(){var e=this.selectConfig,t=void 0===e?{}:e,i=this.selection,l=this.fullDataRowIdMap,o=t.reserve,n=_tools.UtilTools.getRowKey(this);o&&i.length&&(this.selection=i.map(function(e){var t=""+_xeUtils.default.get(e,n);return l.has(t)?l.get(t).row:e}))},toggleRowSelection:function(e){var t=this.selectConfig,i=void 0===t?{}:t,l=this.selection,o=i.checkField||i.checkProp;return this.triggerCheckRowEvent(null,{row:e},o?!_xeUtils.default.get(e,o):-1===l.indexOf(e)),this.$nextTick()},setAllSelection:function(i){var e=this.tableFullData,t=this.editStore,l=this.selectConfig,o=void 0===l?{}:l,n=this.treeConfig,r=this.selection,s=o.reserve,a=o.checkMethod,c=o.checkField||o.checkProp,u=t.insertList,h=[];if(u.length&&(e=e.concat(u)),c){var d=function(e,t){a&&!a({row:e,rowIndex:t})||_xeUtils.default.set(e,c,i)};n?_xeUtils.default.eachTree(e,d,n):e.forEach(d)}else i&&(n?_xeUtils.default.eachTree(e,function(e,t){a&&!a({row:e,rowIndex:t})||h.push(e)},n):h=a?e.filter(function(e,t){return a({row:e,rowIndex:t})}):e.slice(0));this.selection=i&&s?r.concat(h.filter(function(e){return-1===r.indexOf(e)})):h,this.isAllSelected=i,this.isIndeterminate=!1,this.treeIndeterminates=[]},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),checked:t},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.selectConfig,i=void 0===t?{}:t,l=this.treeConfig,o=i.checkField||i.checkProp;return o&&(l?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,o,!1)},l):e.forEach(function(e){return _xeUtils.default.set(e,o,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},triggerRowEvent:function(e,t){var i=t.row;return _tools.UtilTools.emitEvent(this,"select-change",[{row:i},e]),this.setCurrentRow(i)},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.selectRow=e),this.$nextTick()},clearCurrentRow:function(){return this.selectRow=null,this.hoverRow=null,this.$nextTick()},getCurrentRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.hoverRow=i},triggerCellMousedownEvent:function(e,t){var o=this.$el,i=this.tableData,l=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleSelected,a=this.handleChecked,c=n.checked,u=n.actived,h=t.row,d=t.column,f=t.cell,g=e.button,v=0===g;if((v||2===g)&&r&&"dblclick"===r.trigger)if("row"===r.mode&&u.row===h||u.row===h&&u.column===d);else if(v){e.preventDefault(),e.stopPropagation(),this.handleSelected(t,e);var p=document.onmousemove,m=document.onmouseup,x=_tools.DomTools.getCellIndexs(f),b=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,o,"vxe-body--column"),i=t.flag,l=t.targetElem;i&&a(x,_tools.DomTools.getCellIndexs(l),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=b,document.onmouseup=function(e){document.onmousemove=p,document.onmouseup=m},this.closeFilter(),this.closeMenu()}else{var w=_tools.DomTools.getCellIndexs(f);-1!==c.rows.indexOf(i[w.rowIndex])&&-1!==c.columns.indexOf(l[w.columnIndex])||s(t,e)}},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var o=this.$el,i=this.tableData,l=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleTempChecked,a=n.checked,c=t.button;if((0===c||2===c)&&r&&a.rows.length&&"dblclick"===r.trigger){var u=document.onmousemove,h=document.onmouseup,d={rowIndex:i.indexOf(a.rows[0]),columnIndex:l.indexOf(a.columns[0])},f=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,o,"vxe-body--column"),i=t.flag,l=t.targetElem;i&&s(d,_tools.DomTools.getCellIndexs(l),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=f,document.onmouseup=function(e){document.onmousemove=u,document.onmouseup=h,a.rows=a.tRows,a.columns=a.tColumns}}},triggerHeaderCellClickEvent:function(e,t){return _tools.UtilTools.emitEvent(this,"header-cell-click",[t,e]),this.setCurrentColumn(t.column,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.selectColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.selectColumn=null},triggerCellClickEvent:function(e,t){var i=this,l=this.$el,o=this.highlightCurrentRow,n=this.editStore,r=this.selectConfig,s=this.treeConfig,a=this.editConfig,c=n.actived,u=t.column,h=t.columnIndex;o&&(this.getEventTargetNode(e,l,"vxe-tree-wrapper").flag||this.getEventTargetNode(e,l,"vxe-checkbox").flag||this.setCurrentRow(t.row)),r&&("row"===r.trigger||"selection"===u.type&&"cell"===r.trigger)&&!this.getEventTargetNode(e,t.cell,"vxe-checkbox").flag&&this.toggleRowSelection(t.row,e),s&&("row"===s.trigger||u.treeNode&&"cell"===s.trigger)&&this.triggerTreeExpandEvent(e,t),a&&("click"===a.trigger?c.args&&e.currentTarget===c.args.cell||("row"===a.mode?this.triggerValidate("blur").then(function(){}).catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===a.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})):c.row&&c.row&&(c.column=c.args.column=u,c.columnIndex=c.args.columnIndex=h)),_tools.UtilTools.emitEvent(this,"cell-click",[t,e])},triggerCellDBLClickEvent:function(e,t){var i=this.editStore,l=this.editConfig,o=i.actived;l&&"dblclick"===l.trigger&&(o.args&&e.currentTarget===o.args.cell||this.handleActived(t,e)),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var i=this,l=this.editStore,o=this.editConfig,n=o.activeMethod,r=l.actived,s=e.row,a=e.column,c=e.cell;if(a.editRender)if("row"===o.mode?r.row!==s:r.row!==s||r.column!==a){var u="edit-disabled";n&&!n(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),u="edit-actived",a.renderHeight=c.offsetHeight,r.args=e,r.row=s,r.column=a,this.$nextTick(function(){i.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,u,[e,t])}else a.renderHeight=c.offsetHeight,r.args=e,r.column!==a&&this.clearValidate(),setTimeout(function(){i.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,i=t.args,l=t.row,o=t.column;return(l||o)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[i,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){var e=this.$el,t=this.editStore,i=this.tableData,l=t.actived,o=l.args,n=l.row;return o&&-1<i.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},o):null},hasActiveRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore.selected;return t.row=null,t.column=null,this.$nextTick()},handleSelected:function(t,i){var l=this,e=this.mouseConfig,o=void 0===e?{}:e,n=this.editStore.selected,r=t.row,s=t.column;return function(){if(n.row===r&&n.column===s||(l.clearChecked(i),l.clearActived(i),n.args=t,n.row=r,n.column=s),o.checked){var e=_tools.DomTools.getCellIndexs(t.cell);l.handleChecked(e,e,i)}return l.$nextTick()}()},clearChecked:function(e){var t=this.editStore.checked;return t.rows=[],t.columns=[],t.tRows=[],t.tColumns=[],this.$nextTick()},handleChecked:function(e,t,i){var l=this.tableData,o=this.visibleColumn,n=this.editStore.checked,r=e.rowIndex,s=e.columnIndex,a=t.rowIndex,c=t.columnIndex;n.tRows=[],n.tColumns=[],n.rows=r<a?l.slice(r,a+1):l.slice(a,r+1),n.columns=s<c?o.slice(Math.max(s,1),c+1):o.slice(Math.max(c,1),s+1)},handleTempChecked:function(e,t,i){var l=this.tableData,o=this.visibleColumn,n=this.editStore.checked,r=n.rows,s=n.tRows,a=n.columns,c=n.tColumns,u=e.rowIndex,h=e.columnIndex,d=t.rowIndex,f=t.columnIndex;s.length>r.length?f=o.indexOf(a[a.length-1]):c.length>a.length&&(d=l.indexOf(r[r.length-1])),u<d?n.tRows=l.slice(u,d+1):(u+=r.length,n.tRows=l.slice(d,u)),h<f?n.tColumns=o.slice(Math.max(h,1),f+1):(h+=a.length,n.tColumns=o.slice(Math.max(f,1),h))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e,t){var i=this.editStore,l=i.copyed,o=i.checked;l.cut=e,l.rows=o.rows,l.columns=o.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,i=this.editStore,l=i.copyed,o=i.selected,r=l.cut,s=l.rows,a=l.columns;if(s.length&&a.length&&o.row&&o.column){var c=o.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(l,e){var o=t[u+e];o&&a.forEach(function(e,t){var i=n[h+t];i&&_tools.UtilTools.setCellValue(o,i,_tools.UtilTools.getCellValue(l,e)),r&&_tools.UtilTools.setCellValue(l,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e,t){var i=e.column,l=e.cell,o=i.editRender;if(o){var n,r=_vXETable.Renderer.get(o.name),s=o.autofocus,a=o.autoselect;s&&(n=l.querySelector(s)),!n&&r&&r.autofocus&&(n=l.querySelector(r.autofocus)),n&&n[a?"select":"focus"]()}},setActiveRow:function(e){return this.setActiveCell(e,this.visibleColumn.find(function(e){return e.editRender}).property)},setActiveCell:function(s,a){var c=this;return new Promise(function(r){setTimeout(function(){var e=c.tableData,t=c.visibleColumn,i=c.handleActived;if(s&&a){var l=e.indexOf(s);if(-1<l){var o=t.find(function(e){return e.property===a}),n=_tools.DomTools.getCell(c,{row:s,rowIndex:l,column:o});i({row:s,column:o,cell:n}),c.lastCallTime=Date.now()}}r(c.$nextTick())})})},setSelectCell:function(e,t){var i=this.tableData,l=this.editConfig,o=this.visibleColumn;if(e&&t&&"manual"!==l.trigger){var n=o.find(function(e){return e.property===t}),r=i.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:o.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},triggerSortEvent:function(e,t,i,l){this.sort(t.property,l)},sort:function(t,e){var i=this.visibleColumn,l=this.tableFullColumn,o=this.remoteSort,n=i.find(function(e){return e.property===t}),r=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:o;return e&&n.order!==e&&(l.forEach(function(e){e.order=null}),n.order=e,r||(this.tableData=this.getTableData(!0).tableData),_tools.UtilTools.emitEvent(this,"sort-change",[{column:n,prop:t,field:t,order:e}])),this.$nextTick()},triggerFilterEvent:function(e,t,i){var l=this.$refs,o=this.filterStore,n=this.overflowX;if(o.column===t&&o.visible)o.visible=!1;else{var r=e.target,s=l.tableBody.$el,a=l.filterWrapper,c=_tools.DomTools.getOffsetPos(r),u=c.top,h=c.left;n&&(h-=s.scrollLeft),Object.assign(o,{args:i,multiple:t.filterMultiple,options:t.filters,column:t,style:{zIndex:_conf.default.tooltip.zIndex,top:"".concat(u+r.clientHeight+6,"px"),left:"".concat(h,"px")},visible:!0}),o.isAllSelected=o.options.every(function(e){return e.checked}),o.isIndeterminate=!this.isAllSelected&&o.options.some(function(e){return e.checked}),this.$nextTick(function(){var e=a.$el;o.style.top="".concat(u+r.clientHeight+6,"px"),o.style.left="".concat(h-e.clientWidth/2+10,"px")})}},confirmFilterEvent:function(e){var t=this.visibleColumn,i=this.filterStore,l=this.remoteFilter,o=this.scrollXLoad,n=this.scrollYLoad,r=i.column,s=[];r.filters.forEach(function(e){e.checked&&s.push(e.value)}),i.visible=!1,l||(this.tableData=this.getTableData(!0).tableData);var a=[];t.filter(function(e){var t=e.property,i=e.filters,l=[];i&&i.length&&(i.forEach(function(e){e.checked&&l.push(e.value)}),a.push({column:e,field:t,prop:t,values:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,field:r.property,prop:r.property,values:s,filters:a}]),(o||n)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){return this.visibleColumn.forEach(function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1})}),Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.tableData=this.getTableData(!0).tableData,this.$nextTick()},triggerRowExpandEvent:function(e,t){var i=t.row,l=this.toggleRowExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:i,rowIndex:this.getRowMapIndex(i),$table:this},e]),l},toggleRowExpansion:function(e){return this.setRowExpansion(e)},handleDefaultRowExpand:function(){var e=this.expandConfig,t=void 0===e?{}:e,i=this.tableFullData,l=t.expandAll,o=t.expandRowKeys,n=_tools.UtilTools.getRowKey(this);if(l)this.expandeds=i.slice(0);else if(o){var r=n;if(!r)throw new Error("[vxe-table] Expand rows must have a unique primary key.");this.expandeds=o.map(function(t){return i.find(function(e){return t===e[r]})})}},setAllRowExpansion:function(e){return this.expandeds=e?this.tableFullData.slice(0):[],this.$nextTick()},setRowExpansion:function(e,i){var l=this.expandeds,t=this.expandConfig,o=void 0===t?{}:t,n=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),o.accordion&&(l.length=0,e=e.slice(e.length-1,e.length)),e.forEach(function(e){var t=l.indexOf(e);-1<t?!n&&i||l.splice(t,1):(n||i)&&l.push(e)})),this.$nextTick()},hasRowExpand:function(e){return-1<this.expandeds.indexOf(e)},clearRowExpand:function(){return this.expandeds=[],this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=t.row,l=this.toggleTreeExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:i,rowIndex:this.getRowMapIndex(i),$table:this},e]),l},toggleTreeExpansion:function(e){return this.setTreeExpansion(e)},handleDefaultTreeExpand:function(){var e=this.rowKey,l=this.treeConfig,o=this.tableFullData;if(l){var t=l.key,i=l.expandAll,n=l.expandRowKeys,r=l.children,s=e||t,a=[];i?(_xeUtils.default.filterTree(o,function(e){var t=e[r];t&&t.length&&a.push(e)},l),this.treeExpandeds=a):n&&(n.forEach(function(t){var e=_xeUtils.default.findTree(o,function(e){return t===e[s]},l),i=e?e.item[r]:0;i&&i.length&&a.push(e.item)}),this.treeExpandeds=a)}},setAllTreeExpansion:function(e){var t=this.tableFullData,i=this.treeConfig,l=i.children,o=[];return e&&_xeUtils.default.eachTree(t,function(e){var t=e[l];t&&t.length&&o.push(e)},i),this.treeExpandeds=o,this.$nextTick()},setTreeExpansion:function(e,o){var n=this.tableFullData,r=this.treeExpandeds,s=this.treeConfig,a=s.children,c=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),s.accordion&&(e=e.slice(e.length-1,e.length)),e.forEach(function(t){var e=t[a];if(e&&e.length){var i=r.indexOf(t);if(s.accordion){var l=_xeUtils.default.findTree(n,function(e){return e===t},s);_xeUtils.default.remove(r,function(e){return-1<l.items.indexOf(e)})}-1<i?!c&&o||r.splice(i,1):(c||o)&&r.push(t)}})),this.$nextTick()},hasTreeExpand:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){return this.treeExpandeds=[],this.$nextTick()},isScrollXLoad:function(){return this.scrollXLoad},isScrollYLoad:function(){return this.scrollYLoad},triggerScrollXEvent:function(e){for(var t=this.$refs,i=this.visibleColumn,l=this.scrollXStore,o=l.startIndex,n=l.renderSize,r=l.offsetSize,s=l.visibleSize,a=t.tableBody.$el,c=a.scrollLeft,u=0,h=0,d=0;d<i.length;d++)if(h+=i[d].renderWidth,c<h){u=d;break}if(l.visibleIndex!==u){var f=0,g=n<3*s,v=n-s;(l.visibleIndex>u?(f=v-(g?Math.floor(v/2):Math.floor(6*s<n?3*s:1.5*s)),u-r<=o):(f=g?Math.floor(v/2):Math.floor(6*s<n?3*s:1.5*s),o+n<=u+s+r))&&(l.visibleIndex=u,l.startIndex=Math.min(Math.max(u-f,0),i.length-n),this.updateScrollXSpace(),this.$nextTick(function(){a.scrollLeft=c}))}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.tableFullData,i=this.scrollYStore,l=i.startIndex,o=i.renderSize,n=i.offsetSize,r=i.visibleSize,s=i.rowHeight,a=e.target,c=a.scrollTop,u=Math.ceil(c/s);if(i.visibleIndex!==u){var h=0,d=o<3*r,f=o-r;(i.visibleIndex>u?(h=f-(d?Math.floor(f/2):Math.floor(6*r<o?3*r:1.5*r)),u-n<=l):(h=d?Math.floor(f/2):Math.floor(6*r<o?3*r:1.5*r),l+o<=u+r+n))&&(i.visibleIndex=u,i.startIndex=Math.min(Math.max(u-h,0),t.length-o),this.updateScrollYSpace(),this.$nextTick(function(){a.scrollTop=c}))}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeScrollLoad:function(){var e=this.scrollXLoad,t=this.scrollYLoad,i=this.scrollYStore,l=this.scrollXStore,o=this.visibleColumn,n=this.optimizeOpts,r=n.scrollX,s=n.scrollY,a=this.$refs.tableBody,c=a?a.$el:null,u=this.$refs.tableHeader;if(c&&(e&&(l.visibleSize=r.vSize||Math.ceil(c.clientWidth/(o.slice(0,10).reduce(function(e,t){return e+t.renderWidth},0)/10)),this.updateScrollXSpace()),t)){if(s.rHeight)i.rowHeight=s.rHeight;else{var h=c.querySelector("tbody>tr");!h&&u&&(h=u.$el.querySelector("thead>tr")),h&&(i.rowHeight=h.clientHeight)}i.visibleSize=s.vSize||Math.ceil(c.clientHeight/i.rowHeight),this.updateScrollYSpace()}},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.getTableData(),i=t.fullData,l=t.tableData;this.tableData=l,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((i.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},clearScroll:function(){var o=this;return Object.assign(this.scrollXStore,{visibleSize:0,startIndex:0,leftSpaceWidth:0,rightSpaceWidth:0}),Object.assign(this.scrollYStore,{visibleSize:0,startIndex:0,topSpaceHeight:0,bottomSpaceHeight:0}),this.$nextTick(function(){var e=o.$refs.tableBody,t=e?e.$el:null,i=o.$refs.tableFooter,l=i?i.$el:null;t&&(t.scrollTop=0,t.scrollLeft=0),l&&(l.scrollLeft=0)}),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.editStore.insertList.concat(this.tableFullData)}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,i=u.editRules,l=u.validStore;if(a&&e.tableBody&&i){var o=a.row,n=a.column;if(u.hasCellRules("change",o,n)){var r=t.indexOf(o),s=_tools.DomTools.getCell(u,{row:o,rowIndex:r,column:n});if(s)return u.validCellRules("change",o,n,c).then(function(){h&&l.visible&&_tools.UtilTools.setCellValue(o,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(o,n,c),u.showValidTooltip({rule:t,row:o,column:n,cell:s})})}}})},triggerValidate:function(l){var o=this,e=this.editConfig,t=this.editStore,i=this.editRules,n=this.validStore,r=t.actived;if(r.row&&i){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(l,a,c))return this.validCellRules(l,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&o.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&l!==t.trigger)return Promise.resolve();var i={rule:t,row:a,column:c,cell:u};return o.showValidTooltip(i),Promise.reject(i)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,c,u){var h=this,d={},f=!0,t=this.editRules,i=this.tableData,l=this.tableFullData,g=this.scrollYLoad,v=this._scrollYStore,o=g?l:i;e&&(_xeUtils.default.isFunction(e)?c=e:o=_xeUtils.default.isArray(e)?e:[e]);var n=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var a=this.getColumns();return o.forEach(function(r){var s=i.indexOf(r),e=[];a.forEach(function(o,n){_xeUtils.default.has(t,o.property)&&e.push(new Promise(function(i,l){h.validCellRules("all",r,o).then(i).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:s,row:r,columnIndex:n,column:o};return u?(d[o.property]||(d[o.property]=[]),d[o.property].push(t),i()):l(t)})}))}),n.push(Promise.all(e))}),Promise.all(n).then(function(){var e=Object.keys(d);if(e.length)return Promise.reject(d[e[0]][0]);c&&c(f)}).catch(function(s){var a=u?d:_defineProperty({},s.column.property,s);return new Promise(function(e,t){var i=function(){s.cell=_tools.DomTools.getCell(h,s),h.handleValidError(s),c?e(c(f=!1,a)):t(a)};if(g){var l=v.startIndex,o=v.renderSize,n=v.rowHeight,r=h.getRowMapIndex(s.row);if(r<l||l+o<r)return h.$refs.tableBody.$el.scrollTop=(r-1)*n,setTimeout(i,40)}i()})})}return c&&c(f),Promise.resolve(!0)},hasCellRules:function(t,e,i){var l=this.editRules,o=i.property;if(o&&l){var n=_xeUtils.default.get(l,o);return n&&n.find(function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,i=c.property,h=[],l=[];if(i&&t){var d=_xeUtils.default.get(t,i),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,i):e;d&&d.forEach(function(r){l.push(new Promise(function(i){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)i();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};h.push(t)}return i()},{rules:d,row:a,column:c,rowIndex:u.getRowMapIndex(a),columnIndex:u.getColumnMapIndex(c)});else{var t,l=f,o="number"===r.type,n=null==f||""===f;o?l=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(l),e&&n?h.push(r):(o&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(o?l<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(o?l>r.max:t>r.max))&&h.push(r),i()}}))})}return Promise.all(l).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,i=this.$refs,l=this.tableData,o=this.validConfig,n=void 0===o?{}:o,r=i.validTip,s=e.rule,a=e.row,c=e.column,u=e.cell;this.$nextTick(function(){Object.assign(t.validStore,{row:a,column:c,rule:s,content:_tools.UtilTools.formatText(s.message),visible:!0}),!r||"tooltip"!==n.message&&1!==l.length||r.toVisible(u),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){var t=this.visibleColumn,i=this.scrollXLoad,l=this.scrollYLoad,o=this.treeConfig,n=Object.assign({filename:"table.csv",original:!!o,isHeader:!0,download:!0,data:null,columns:null,columnFilterMethod:function(e){return-1===["index","selection","radio"].indexOf(e.type)&&e.property},dataFilterMethod:null},e);-1===n.filename.indexOf(".csv")&&(n.filename+=".csv"),(i||l)&&(n.original=!0);var r=t,s=this.getTableData().fullData;return o&&(s=_xeUtils.default.toTreeArray(s,o)),_tools.ExportTools.downloadCsc(n,_tools.ExportTools.getCsvContent(n,s,r,this.$el))},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;